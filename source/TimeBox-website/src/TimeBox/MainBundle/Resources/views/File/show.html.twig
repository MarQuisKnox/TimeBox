{% extends "TimeBoxMainBundle::layout.html.twig" %}

{% block container %}

    <div class="actions">
        <ul>
            <li>Actions:</li>
            <li><img src="{{ asset('img/icons/folder-add.png') }}" alt="folder add icon" />New folder</li>
            <li>
                <img src="{{ asset('img/icons/file-upload.png') }}" alt="upload icon" />
                <a href="{{ path('time_box_main_file_upload') }}">Upload a new file</a>
            </li>
            <li class="FileRelatedAction"><img src="{{ asset('img/icons/file-download.png') }}" alt="download icon" />Download</li>
            <li class="FileRelatedAction"><img src="{{ asset('img/icons/file-delete.png') }}" alt="file delete icon" />Delete</li>
            <li class="FileRelatedAction"><img src="{{ asset('img/icons/link.png') }}" alt="share icon" style="padding-bottom:1px;" />Share</li>
            <li class="FileRelatedAction"><img src="{{ asset('img/icons/file-edit.png') }}" alt="rename icon" />Rename</li>
            <li class="FileRelatedAction"><img src="{{ asset('img/icons/file-go.png') }}" alt="move icon" />Move</li>
            <li class="FileRelatedAction"><img src="{{ asset('img/icons/file-copy.png') }}" alt="copy icon" />Copy</li>
        </ul>
    </div>

    <table class="file">
        <thead>
            <tr>
                <td colspan="4" class="driveBreadcrumb">
                    <span class="fLeft"><a href="{{ path('time_box_main_file') }}">Drive</a></span>
                    <ul>
                        {% for folder in breadcrumb %}
                            <li><a href="{{ path('time_box_main_file', {'folderId':folder.id}) }}">{{ folder.name }}</a></li>
                        {% endfor %}
                    </ul>
                </td>
            </tr>
        </thead>
        <tbody class="selectable">
            <tr>
                <th class="fileType">{# Type #}</th>
                <th class="fileTitle">Title</th>
                <th class="size">Size</th>
                <th class="lastEdit">Last Edit</th>
            </tr>
            {% for folder in folders %}
            <tr>
                <td class="fileType">
                    <img src="{{ asset('img/icons/folder.png') }}" alt="folder icon" />
                </td>
                <td class="fileTitle">
                    <a href="{{ path('time_box_main_file', {'folderId': folder.id}) }}">{{ folder.name }}</a>
                </td>
                <td class="size"></td>
                <td class="lastEdit"></td>
            </tr>
            {% endfor %}
            {% for file in files %}
            <tr data-id="{{ file.id }}" class="file">
                <td class="fileType">
                {% if file.type in types %}
                    <img src="{{ asset('img/icons/file-' ~ file.type ~ '.png') }}" alt="{{ file.type }} icon" />
                {% else %}
                    <img src="{{ asset('img/icons/file.png') }}" alt="{{ file.type }} icon" title="{{ file.type }}" />
                {% endif %}
                </td>
                <td class="fileTitle">{{ file.name }}</td>
                <td class="size">
                {% if file.size > 1000000  %}
                    {{ file.size // 1000000 + 1 }} mo
                {% elseif file.size > 1000  %}
                    {{ file.size // 1000 + 1 }} ko
                {% else %}
                    {{ file.size }} o
                {% endif %}
                </td>
                <td class="lastEdit">
                {% if "now"|date("Y/m/d") == file.date|date('Y/m/d') %}
                    {{ file.date|date('H:i') }}
                {% else %}
                    {{ file.date|date('Y/m/d') }}
                {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div id="tbVersions" class="file">
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/jquery-1.10.2.js') }}" type="text/javascript"></script>

    <script>
        $(document).ready(function() {
            $( "li.FileRelatedAction" ).hide( 0 );
            $("tr.file").click(function(){
                $(this).siblings().removeClass("selected");

                $(this).toggleClass("selected");
                if ($(this).hasClass("selected")) {
                    $( "li.FileRelatedAction" ).show( "slow" );

                    $("tr.version ul").slideUp(function() {
                        $("tr.version").remove();
                    });
                    var fileId = $(this).attr('data-id');
                    $.ajax({
                        url: "{{ path('time_box_main_file_versions') }}",
                        context: this,
                        type: "POST",
                        data: {'fileId': fileId},
                        success: function( data ) {
                            $(this).after( data );
                            $("tr.version ul").hide().slideDown();
                        }
                    });
                }
                else {
                    $( "li.FileRelatedAction" ).hide( "slow" );

                    $("tr.version ul").slideUp(function() {
                        $("tr.version").remove();
                    });
                }
            });
        });
    </script>
{% endblock %}
